500ms使いつつ、どうするか
板情報は最後のフィルターとして使う

H1でトレンドみる
M1でサイン
10Sでエントリー

ctraderでは過去1年分のバックテストしかできないので、duckascopyから過去5年分のデータ取得中
これ終わったら上記ロジックをテストしてみる
ロジックの作り方を教わったので気をつけよう
なんだっけ名前、気をつけるの
とにかく数値をいじって結果を良くするのはダメ
根拠を持って上位足からフィルターをかけていく
数値をいじって調整するのはカーブフィッティングで意味ない


承知しました、高科さん。いま固めつつある「**10秒足＝実行（トリガー）**」のロジックを、できるだけ曖昧さが残らない形でまとめます。  
（前提：方向＝上位足、10秒足は“入るだけ”。裁量が入らない設計。）

---

# 10秒足ロジック仕様（実行トリガー）

## 0. 前提データ

- 対象：USDJPY（pip=0.01）
    
- 実行足：10秒バー（OHLC）
    
- 時刻：UTC（cTraderのサーバ時刻がUTC+0）
    
- エントリ方向：**Buy only**（現状の検証ではSellが足を引っ張るため）
    

---

## 1. 稼働フィルタ（10秒足の前に必ず判定）

### 1-1. セッションフィルタ（必須）

- ロンドン時間のみに限定
    
    - `W1 = [08:00, 11:00)` UTC
        
- それ以外は **一切取引しない**
    

### 1-2. 週末フィルタ（FXなので必須）

- 土日：取引しない
    
- 金曜後半停止（任意だが推奨）
    
    - `Friday >= 16:00 UTC` は停止  
        （週末ギャップ前のノイズ回避＋ティルト防止）
        

### 1-3. ロールオーバー回避（任意だが推奨）

- `21:55–22:10 UTC` を停止（ブローカーに合わせて調整）
    
- 理由：スプレッド拡大・挙動悪化
    

---

## 2. 上位足バイアス（10秒足は「方向」を見ない）

### 2-1. 上位足の定義

- H1（1時間足）を10秒足からリサンプル（or cTraderのH1）
    
- 直近“確定”H1バーを使用（未確定は使わない）
    

### 2-2. Uptrend判定（H1トレンドフィルタ）

- `EMA50`（H1 close）
    
- `SlopeBars = 6`（デフォルト）
    

**Uptrend = True 条件**

1. `H1_Close(prev) > EMA50(prev)`
    
2. `EMA50(prev) > EMA50(prev - SlopeBars)` （EMAが上向き）
    

これが満たされない場合、10秒足トリガーは無効（取引停止）。

※ ここは「条件を増やしすぎない」が最重要。まずこれだけ。

---

## 3. 10秒足エントリトリガー（超シンプル）

### 3-1. トリガーの目的

- 10秒足は「今入る」を決めるだけ
    
- **“解釈”禁止**（OB/CHoCH等を10秒足でやらない）
    

### 3-2. ブレイク条件（Buy）

パラメータ：

- `Lookback = 6`（10秒バー本数）
    

判定時点：

- **確定足**（バーが閉じたタイミング）で判断
    

定義：

- `recentHigh = max(High[i-Lookback ... i-1])`
    
- `trigger = Close[i] > recentHigh`
    

`trigger == True` のとき、Buyエントリを発生。

---

## 4. エントリ約定モデル（バックテストでぶれないように固定）

10秒足のブレイク判定は「終値」で行うため、実装上は次のどちらかに固定します。

### 推奨A（保守的・再現性高い）

- **次バーのOpenで成行相当**
    
    - `entry_price = Open[i+1] + half_spread`
        
- 理由：同バー内で理想約定しないようにする（過剰最適化を防ぐ）
    

### 推奨B（cTrader実運用寄り）

- シグナル発生時点で **成行**
    
    - `entry_price = current_ask`（またはClose + half_spread）
        
- ただしバックテストと乖離しやすいので、Aで検証→Bで前進テストが堅い
    

---

## 5. ポジション制御（裁量排除の肝）

### 5-1. 同時保有

- **1ポジションのみ**
    
    - 既にポジションがある場合、シグナルが出ても無視
        

### 5-2. 1方向1回（任意だが強い）

- バイアスが Buy の間は **1回だけ**
    
- 以後、バイアスが None になる or 条件が崩れるまで再エントリ禁止  
    （ノイズの連打を防ぐ）
    

---

## 6. SL / TP（固定で良い。まずは崩さない）

### 6-1. SL

- `SL = 10 pips`（固定）
    
    - `sl_price = entry_price - 10 * pip`
        

### 6-2. TP

- `TP = SL * RR`（RR=1.2）
    
    - `tp_price = entry_price + 10 * RR * pip`
        

### 6-3. 同一バー内の優先順位（バックテストの規約）

- 同じ10秒バーで `High >= TP` と `Low <= SL` が両方起きた場合は
    
    - **SL優先（保守的）**
        
- 理由：後から「現実はTP先だったかも」を言い出す余地を消す
    

---

## 7. コストモデル（現実寄せ）

### 7-1. スプレッド

- 固定スプレッド `spread_pips` を仮定し、
    
    - Buy entry は `+ half_spread`
        
    - Buy exit は `- half_spread`
        
- DukascopyでBid/Askがあるなら、最終的には実スプレッドに差し替え可能
    

### 7-2. コミッション

- Axiory/cTraderの条件に合わせて
    
    - 0でも良い（まずはスプレッドのみで比較）
        
    - あるなら `per million` で追加
        

---

## 8. ティルト防止（運用時に効く）

バックテストでは一旦OFFにしてもいいですが、実運用では強いです。

- `max_trades_per_day`（例：3〜5）
    
- `stop_after_losses`（例：2連敗で当日停止）
    

「勝つため」ではなく **壊れないため**に入れます。

---

# 最終まとめ（仕様の一文）

**ロンドン時間（UTC 08:00–11:00）に限り、H1が上向き（Close>EMA50 かつ EMA上昇）なら、10秒足で直近N本高値を終値で上抜けた次バーでBuy。SL固定・TP=RR倍、1ポジションのみ、同バーSL/TPはSL優先。**

---

必要なら、この仕様をそのまま **Pythonの関数仕様（入力・出力・例）**に落とした “テスト可能な形” でも書きます。  
また、Sellをやる場合は「別戦略として」対称形にせず、**NY専用 or 下位足を変える**前提で設計するのが安全です。