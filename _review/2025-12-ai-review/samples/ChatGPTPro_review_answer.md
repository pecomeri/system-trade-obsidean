高科さん、拝見しました。  
結論として、フォルダ構造と「家系（family）で仮説を管理し、in_sample と forward を分けて結果を保存する」設計はかなり良い一方で、**“仕様の確定（言語→判定）”と“検証プロトコル（いつ何を見て良いか）”がテンプレのまま残っている**ため、そこがスヌーピングと停滞の最大リスクになっています。

以下、ご依頼の3点で整理します。

---

## (1) 破綻点（スヌーピング／回らなくなる原因）

### 1) 「何を良くしたいか」が仕様化されていない（合意点がない）

review_context がほぼ TODO のままなので、「何を改善したら合格か」「何を見たら打ち切りか」が決まりません。これだと、結果を見ながら評価軸が変わりやすく、スヌーピングに直結します。

**症状**

- “良さそう”に見える指標（PF、勝率、DD、月次安定など）を後から採用してしまう
    
- 次の一手が「追加でフィルター」になりがちで、検証が増殖して回らなくなる
    

---

### 2) Setup / Entry / Filter の「判定定義」が空欄で、後出し変更が無限にできる

S-001 はトレンド／ミッドレンジ／フェイクアウト等の定義が未記入です。  
E-B001 も rebreak 定義や必須条件が空欄です。  
F-C001 も Yes/No 基準が空欄です。

この状態だと、**結果を見てから「定義」を調整できてしまう**ので、プロセス上スヌーピング耐性が弱くなります。

---

### 3) レジーム分類の誤認が“仕様”として検知できない（境界で恣意が入る）

h1_trend_up のメモに「横ばいでも無理にトレンド認定する」という誤認が明記されています。  
これは重要な赤信号で、**「トレンドである」ことを後付けで成立させられる分類器**になっている可能性があります。

**特に危険なのは**

- 「横ばい」を “トレンド扱い” に寄せると、順行しやすい箇所だけが残り、過去に適合しやすい
    

---

### 4) フィルターが増えると「常に見送り」になり、改善に見せかけた撤退が起きる

orderbook_as_last_filter で「板フィルターを増やしすぎて『常に見送り』になる」と自己警告が入っています。  
ここは設計的に破綻しやすいポイントで、**勝率・PFが上がって見えても、実はトレード数を減らしただけ**が起きます。

---

### 5) 結果フォルダの重複・大量生成で「何が効いたか」が追いにくい

results に b001 が同一期間で複数回走っている形跡があり（タイムスタンプ違いで複数フォルダ）、比較の軸（コード差分／データ差分／設定差分）が曖昧になりがちです。  
もちろん「再現性チェックのための複数回実行」自体は良いのですが、**差分のラベルがないとレビュー不能**になります。

---

### 6) 探索空間が広い（戦略ファイルが多い）ので、プロトコルが弱いと“偶然の当たり”を拾いやすい

20_strategies に複数戦略が並び、さらに family_A/B/C と派生（C_v2）もあります。  
探索自体は健全ですが、**「どこまで探索したら打ち切りか」**が決まっていないと、当たりを引くまで続けてしまいます。

---

## (2) 改善提案（スヌーピングを抑え、回り続ける設計）

### A) 「検証プロトコル」を先に固定する（見る順番・変えていい範囲を明文化）

tree を見る限り、in_sample_2024 と forward_2025 の分離は既に資産としてあります。  
これを活かして、運用ルールを1枚に固定するのが一番効きます。

おすすめの最小ルール（例）

- 2024 を **開発** と **検証** に分割（例：H1=上期開発、下期検証）
    
- 2025 は **最終評価（1回だけ）**：ここを見てから定義を変えない
    
- 変更は「差分1つ」の制約を維持（review_context の制約方針とも整合）
    

---

### B) Setup / Entry / Filter を「空欄なし」にしてから結果を見る（プリレジに近づける）

S-001 / E-B001 / F-C001 はリンク関係が整理されていて良いです（Setup→Entry→Filter の参照）。  
ここを本当に強くするには、各ファイルに以下を必須項目として埋めると良いです。

必須項目（おすすめ）

- **定義（Yes/No）を疑似コードで**（自然言語だけにしない）
    
- 境界条件（セッション跨ぎ・欠損・確定/未確定足）
    
- “誤検出パターン” と “ログで見る観点”（E-B001 に枠がすでにある）
    

これで「結果を見てから定義を動かす」余地が大きく減ります。

---

### C) レジーム分類は「不明・横ばい」を明示的に作り、誤認を検知できるようにする

h1_trend_up の誤認に対しては、「横ばいはトレンドではない」を仕組みで担保するのが有効です。

具体策

- H1 を **trend_up / trend_down / range / unknown** の4値にして
    
    - unknown を作る（判定が曖昧な領域は “取らない”）
        
- 判定にヒステリシス（連続N本で確定）を入れて、境界のブレを抑える
    

---

### D) フィルターには「拒否率上限」と「取引数下限」を入れて、過剰フィルターを防ぐ

orderbook は「地雷回避フィルター」という位置づけ自体はすごく良いです。  
ただし “常に見送り” を防ぐため、プロトコルに次を入れると安定します。

- フィルター追加時に必ず記録する指標
    
    - フィルター前後の **trade count / rejection rate / 月次の欠損**
        
- 合格条件
    
    - 「trade count が一定以上」かつ「月次・セッションの偏りが悪化しない」など
        

---

### E) 観測（B006/B007/B008）を“設計の診断”として固定し、フィルター設計の後出しを減らす

results に「観測用の出力」が既に用意されています（例：h1ratio, run_stats, state_labeled）。  
これは強い資産なので、

- 観測 → 仮説 → 実装 → 検証  
    の順に固定し、「結果を見てから観測指標を選ぶ」を避けるのがおすすめです。
    

---

### F) freeze を“儀式”ではなく“ゲート”にする

40_freeze が存在するのはとても良いです。  
ここをゲート化して、

- freeze したら forward を見る
    
- forward を見たら「その実験IDは終了」  
    のルールにすると、検証が回り続けます。
    

---

## (3) 具体的な次アクション3つ（最短で効く順）

### 1) review_context.md を「空欄ゼロ」にして、検証プロトコルを固定

いま review_context の目的・前提・ワークフローが TODO のままなので、まずここを埋めるのが最優先です。

**この1枚に必ず入れると良い項目**

- 対象通貨ペア／期間（例：verify=2024、forward=2025 など）
    
- 合否指標（最低3つ：例「月次の安定」「DD上限」「トレード数下限」）
    
- “forwardを見る条件”（freeze 済みのみ）
    

---

### 2) いまの候補スタックを1つに絞り、S-001 / E-B001 / F-C001 の定義を疑似コードまで落とす

現状は枠があるのに定義が空欄です（S-001 のトレンド等、E-B001 の rebreak 定義、F-C001 の Yes/No）。

**成果物（各ファイルに追記）**

- 判定の疑似コード（if/elseで書けるレベル）
    
- 境界条件（確定足/未確定足、欠損、セッション）
    
- 誤検出例と、ログで確認するキー
    

これをやると、以後の変更が「差分1つ」に収束しやすくなります。

---

### 3) results を1枚サマリ（CSVでもMDでも）に自動集計し、「比較できる状態」を作る

results は config.json / monthly / trades / runlog が揃っているので、集計すれば一気に回り出します。

**やること**

- 各 run フォルダから
    
    - 期間
        
    - 取引数
        
    - PF/期待値（取れている範囲で）
        
    - DD（取れている範囲で）
        
    - monthly_by_session の偏り  
        を抜いて `results/_summary.csv` を生成
        

特に b001 のような重複実行があるので、ここが整うと「何が良くなったか」が追えるようになります。

---

必要であれば、高科さんが次に貼ってくださる情報が最小で済むように、こちらで **review_context.md の“埋めるべき雛形（完成例）”**も作れます。  
ただ、いまの段階でも上の3ステップを入れるだけで、スヌーピング耐性と回転率はかなり上がると思います。